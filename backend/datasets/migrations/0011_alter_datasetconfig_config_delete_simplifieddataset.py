# Generated by Django 5.2.6 on 2026-01-10 13:58

from django.db import migrations, models


def remove_simplified_dataset(apps, schema_editor):
    SimplifiedDataset = apps.get_model("datasets", "SimplifiedDataset")
    Dataset = apps.get_model("datasets", "Dataset")
    DatasetConfig = apps.get_model("datasets", "DatasetConfig")

    print("Migrating SimplifiedDataset data to Dataset and DatasetConfig...")

    for sds in SimplifiedDataset.objects.all():
        dataset = Dataset.objects.create(
            slug=sds.slug,
            pipeline=sds.pipeline,
        )
        DatasetConfig.objects.create(
            dataset=dataset,
            config=sds.config,
            state="Published",
        )


class Migration(migrations.Migration):
    dependencies = [
        ("datasets", "0010_alter_dataset_state"),
    ]

    operations = [
        migrations.AlterField(
            model_name="datasetconfig",
            name="config",
            field=models.JSONField(blank=True, default=dict),
        ),
        migrations.RunPython(remove_simplified_dataset),
        migrations.DeleteModel(
            name="SimplifiedDataset",
        ),
    ]
